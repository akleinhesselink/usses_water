# plot species lines
geom_line(size = 1) +
# faceted by species
facet_wrap(~replicate2)
ggplot(aggdat, aes(year, abundance, color = species)) +
# plot species lines
geom_line(size = 1) +
# faceted by species
facet_wrap(~replicate2) +
coord_polar()
ggplot(aggdat, aes(year, abundance, color = species)) +
# plot species lines
geom_line(size = 1) +
# faceted by species
facet_wrap(~replicate2) +
coord_polar()+
# label axes
labs(x="Year", y="Abundance", color="Species") +
# format
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
# color-blind friendly palette
scale_color_manual( values = cbbPalette) +
# add a line to indicate the start
geom_segment(aes(x = 1984, y = 0, xend = 1984, yend = 100), color = "grey70")
ggplot(aggdat, aes(year, abundance, color = species)) +
# plot species lines
geom_line(size = 1) +
# faceted by species
facet_wrap(~replicate2) +
coord_polar()+
# label axes
labs(x="Year", y="Abundance", color="Species") +
# format
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
# add a line to indicate the start
geom_segment(aes(x = 1984, y = 0, xend = 1984, yend = 100), color = "grey70")
####
####  CALCULATE SYNCHRONY OF SPECIES COVER ----
####
cover_species <- read.csv("../data/vital_rates/allrecords_cover_v24.csv") %>%
group_by(quad, year, species) %>%
summarise(total_area = sum(area)) %>%
left_join(plot_info) %>%
filter(Treatment == "Control" | Treatment == "Irrigation" | Treatment == "Drought") %>%
filter(!str_detect(QuadName, 'P1|P7')) %>%
group_by(year, species, Treatment) %>%
summarise(avg_area = mean(total_area)) %>%
ungroup()
ggplot(cover_species, aes(x=year, y=avg_area, col=species))+
geom_line()+
geom_text(data=subset(cover_species,year==2011),aes(label=species))+
facet_grid(Treatment~.)+
guides(color=F)
##  usses_stability.R: R script to analyze the temporal stability of plots at
##    USSES in Idaho. Plots received irrigation/drought treatments starting
##    in 2011.
##
##  Author:       Andrew Tredennick
##  Date created: April 24, 2017
##
##  UPDATES  ###################################################################
##
##
##  ############################################################################
##  Clear the workspace
rm(list=ls(all.names = TRUE))
####
####  LOAD PACKAGES ----
####
library(tidyverse)
library(dplyr)
library(stringr)
library(ggthemes)
library(ggalt)
library(broom)
library(RColorBrewer)
library(lme4)
library(codyn)
library(vegan)
library(gridExtra)
library(car)
####
####  SET DIRECTORIES; READ IN DATA ----
####
# Set working dir to source file location
setwd(dirname(rstudioapi::getActiveDocumentContext()$path)) # only works in RStudio
# Set paths
biomass_path <- "../data/estimated_biomass/"
weather_path <- "../data/weather/"
output_path  <- "../output/"
figure_path  <- "../figures/"
# Read in data
plot_biomass <- readRDS(paste0(biomass_path,"permanent_plots_estimated_biomass.RDS"))
weather_data <- read.csv(paste0(weather_path,"ClimateIPM.csv"))
plot_info    <- read.csv("../data/estimated_biomass/quad_info.csv")
####
####  CALCULATE SYNCHRONY OF SPECIES COVER ----
####
cover_species <- read.csv("../data/vital_rates/allrecords_cover_v24.csv") %>%
group_by(quad, year, species) %>%
summarise(total_area = sum(area)) %>%
left_join(plot_info) %>%
filter(Treatment == "Control" | Treatment == "Irrigation" | Treatment == "Drought") %>%
filter(!str_detect(QuadName, 'P1|P7')) %>%
group_by(year, species, Treatment) %>%
summarise(avg_area = mean(total_area)) %>%
ungroup()
ggplot(cover_species, aes(x=year, y=avg_area, col=species))+
geom_line()+
geom_text(data=subset(cover_species,year==2011),aes(label=species))+
facet_grid(Treatment~.)+
guides(color=F)
cover_ts <- cover_species %>%
filter(year > 2010)
View(cover_ts)
names(cover_ts)
ggplot(cover_ts, aes(year, avg_area, color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x="Year", y="Basal cover", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 100), color = "grey70")
max(cover_ts$avg_area)
## Create the graph
ggplot(cover_ts, aes(year, avg_area, color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x="Year", y="Basal cover", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.5), color = "grey70")
####
####  RANK ABUNDANCE CURVES ----
####
cover_ts <- cover_species %>%
filter(year > 2010, avg_area > 0.01)
## Create the graph
ggplot(cover_ts, aes(year, avg_area, color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x="Year", y="Basal cover", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.5), color = "grey70")
####
####  RANK ABUNDANCE CURVES ----
####
cover_ts <- cover_species %>%
filter(year > 2010, avg_area > 0.05)
## Create the graph
ggplot(cover_ts, aes(year, avg_area, color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x="Year", y="Basal cover", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.5), color = "grey70")
####
####  RANK ABUNDANCE CURVES ----
####
cover_ts <- cover_species %>%
filter(year > 2010)
## Create the graph
ggplot(cover_ts, aes(year, avg_area, color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x="Year", y="Basal cover", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.5), color = "grey70")
####
####  RANK ABUNDANCE CURVES ----
####
domspp <- c("Artemisia tripartita", "Poa secunda", "Psuedoroegneria spicata", "Hesperostipa comata")
cover_ts <- cover_species %>%
filter(year > 2010, species %in% domspp)
## Create the graph
ggplot(cover_ts, aes(year, avg_area, color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x="Year", y="Basal cover", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.5), color = "grey70")
####
####  RANK ABUNDANCE CURVES ----
####
domspp <- c("Artemisia tripartita", "Poa secunda", "Pseudoroegneria spicata", "Hesperostipa comata")
cover_ts <- cover_species %>%
filter(year > 2010, species %in% domspp)
## Create the graph
ggplot(cover_ts, aes(year, avg_area, color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x="Year", y="Basal cover", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.5), color = "grey70")
####
####  RANK ABUNDANCE CURVES ----
####
domspp <- c("Artemisia tripartita", "Poa secunda", "Pseudoroegneria spicata", "Hesperostipa comata")
cover_ts <- cover_species %>%
filter(year > 2010, species %in% domspp)
## Create the graph
ggplot(cover_ts, aes(year, avg_area, color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x="Year", y="Basal cover", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")
## Create the graph
ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x="Year", y="Basal cover", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")
## Create the graph
ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x="Year", y="log(basal cover)", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")
ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y="log(basal cover)", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")
cover_ts <- cover_species %>%
filter(year > 2010)
## Create the graph
ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y="log(basal cover)", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")
cover_ts <- cover_species %>%
filter(year > 2010, species %in% domspp)
## Create the graph
ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y="log(basal cover)", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")
domspp <- c("Artemisia tripartita", "Poa secunda", "Pseudoroegneria spicata", "Hesperostipa comata")
cover_ts <- cover_species %>%
filter(year > 2010)
## Create the graph
g1 <- ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y="log(basal cover)") +
guides(color=FALSE)+
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")+
ggtitle("A. All species")
cover_ts <- cover_species %>%
filter(year > 2010, species %in% domspp)
## Create the graph
g2 <- ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y="log(basal cover)", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")+
ggtitle("B. Dominant species")
grid.arrange(g1,g2,nrow=2)
## Create the graph
g1 <- ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y="log(basal cover)") +
guides(color=FALSE)+
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")+
ggtitle("A. All species")
cover_ts <- cover_species %>%
filter(year > 2010, species %in% domspp)
## Create the graph
g2 <- ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y="log(basal cover)", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")+
guides(color=FALSE)+
ggtitle("B. Dominant species")
grid.arrange(g1,g2,nrow=2)
####
####  RANK ABUNDANCE CURVES ----
####
domspp <- c("Artemisia tripartita", "Poa secunda", "Pseudoroegneria spicata", "Hesperostipa comata")
cover_ts <- cover_species %>%
filter(year > 2010)
## Create the graph
g1 <- ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y="log(basal cover)") +
guides(color=FALSE)+
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")+
ggtitle("A. All species")
cover_ts <- cover_species %>%
filter(year > 2010, species %in% domspp)
## Create the graph
g2 <- ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y="log(basal cover)", color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")+
guides(color=FALSE)+
ggtitle("B. Dominant species")
grid.arrange(g1,g2,nrow=2)
gout <- grid.arrange(g1,g2,nrow=2)
ggsave("../figures/rank_clocks_cover.png", plot = gout, width = 6, height = 8, units="in", dpi=120)
ggsave("../figures/rank_clocks_cover.png", plot = gout, width = 6, height = 5, units="in", dpi=120)
ggsave("../figures/rank_clocks_cover.png", plot = gout, width = 8, height = 5, units="in", dpi=120)
ggsave("../figures/rank_clocks_cover.png", plot = gout, width = 8, height = 6, units="in", dpi=120)
ggsave("../figures/rank_clocks_cover.png", plot = gout, width = 8, height = 7, units="in", dpi=120)
####  RANK ABUNDANCE CURVES ----
####
domspp <- c("Artemisia tripartita", "Poa secunda", "Pseudoroegneria spicata", "Hesperostipa comata")
cover_ts <- cover_species %>%
filter(year > 2010)
## Create the graph
g1 <- ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y=NULL) +
guides(color=FALSE)+
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")+
ggtitle("A. All species")+
theme(axis.title.y=element_blank(),
axis.text.y=element_blank(),
axis.ticks.y=element_blank())
cover_ts <- cover_species %>%
filter(year > 2010, species %in% domspp)
## Create the graph
g2 <- ggplot(cover_ts, aes(year, log(avg_area), color = species)) +
geom_line(size = 1) +
facet_wrap(~Treatment) +
coord_polar()+
labs(x=NULL, y=NULL, color="Species") +
theme_bw() +
theme(text = element_text(size = 14),
strip.text.x = element_text(size = 14),
strip.background = element_blank(),
panel.grid.major = element_line(size = 1)) +
theme(legend.position="bottom",
legend.text=element_text(face = "italic")) +
geom_segment(aes(x = 2011, y = 0, xend = 2011, yend = 0.4), color = "grey70")+
guides(color=FALSE)+
ggtitle("B. Dominant species")+
theme(axis.title.y=element_blank(),
axis.text.y=element_blank(),
axis.ticks.y=element_blank())
gout <- grid.arrange(g1,g2,nrow=2)
ggsave("../figures/rank_clocks_cover.png", plot = gout, width = 8, height = 7, units="in", dpi=120)
